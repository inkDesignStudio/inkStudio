# Стартовый шаблон для разработки тем
Проект для быстрого старта разработки тем под CMS-ку и хранения стандартных блоков, согласованных с командой дизайнеров

## Содержание
1. [Установка](#установка)
2. [Настройка деплоймент-процесса](#настройка-деплоймент-процесса)
3. [БЭМ методология](#бэм-методология)
4. [Структура проекта](#структура-проекта)
    1. [Разметка](#разметка)
    2. [Стили](#стили)
    3. [Картинки](#картинки)
5. [Работа с блоками](#работа-с-блоками)
6. [Основные команды](#основные-команды)


## Установка
**ВАЖНО!**
Для работы с проектом вам нужен [Node.js](https://nodejs.org/en/download/)
([инструкция](https://websiteforstudents.com/install-the-latest-node-js-and-nmp-packages-on-ubuntu-16-04-18-04-lts/)
по установке для Ubuntu) и его менеджер пакетов [npm](https://www.npmjs.com/)
(идёт в комплекте с Node.js). Чтобы проверить наличие `Node.js` и `npm` в системы проверьте в консоли их версию:
```console
$ node -v
v10.15.1
$ npm -v
6.8.0
```
Для того чтобы вы могли запускать команды типа `gulp serve` вам нужен пакет `gulp-cli`, установленный глобально:
```console
$ npm i gulp-cli -g
```

Также, мы используем [git flow](https://danielkummer.github.io/git-flow-cheatsheet/index.ru_RU.html),
чтобы структурировать и максимально контролировать процесс разработки. Установите его в свою систему, поставьте плагин
Git Flow в свой редактор кода.

После того, как всё вышеперечисленное уже установлено в вашу систему, нужно выполнить следующий алгоритм:
1. Клонируем этот репозиторий из ветки `master` себе локально
2. Создайте папку для проекта, с которым вы будете работать (это не та же папка, которую вы скачали с этого репозитория)
3. Подключите удаленный репозиторий
    ```console
    $ git init
    $ git remote add origin url_to_your_remote_repo
    $ git add .
    $ git commit -m "Initial commit"
    $ git push -u origin master
    ```
4. Скопируйте файлы этого репозитория, **вместе с скрытыми файлами** в папку с вашим проектом
(дальше работаем в папке вашего проекта)
5. Инициализируйте `git flow`
6. Открываем доступную вам консоль и устанавливаем sass `npm i node-sass`
7. Теперь устанавливаем все остальные зависимости в папке с проектом
с помощью команды `npm install` или используя алиас `npm i`
8. Окружение готово. Используйте описанные ниже [gulp-таски](#основные-команды), чтобы получить нужный результат


## Настройка деплоймент-процесса
После того, как вы скачали стартовый репозиторий и изменили `origin`, вам нужно настроить деплоймент на FTP,
где вы будете разрабатывать проект.

**ВАЖНО!** Добавьте папку `node_modules/` в настройках деплоймента в
`Excluded Paths`. После этого, вам нужно залить свои локальные файлы в папку с темой
`/var/www/your-project-folder/public/wp-content/themes/your-project-theme`. Также, в конфигурационном файле темы
`fred-config.json` укажите домен (`"domain": "http://your-project-domain"`),
на котором вы будете разрабатывать проект и название папки с темой (`"themeFolder": "your-project-theme"`)


## БЭМ методология
Мы используем [БЭМ](https://ru.bem.info/methodology/key-concepts/) при разработке.


## Структура проекта
Всё очень похоже на старый добрый WordPress только с рядом улучшений. Разработка не разделяется на `src` и `dist`.
Всё храним в папке темы. По мимо привычных папок `img` и `js` используется [components](#работа-с-блоками)
для хранения разметки и стилей для отдельных блоков интерфейса.

### Разметка
Разметку сетки страниц делаем в блоке `page`. У него нет стандартизированой разметки по-этому мы используем только
файл стилей `_page.scss`, в котором используем примерно следующее элементы:
```html
<!doctype html>
<html class="page page--no-scroll" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Basic Markup Example</title>
</head>
<body class="page__body">
    <header class="page__header main-header"></header>
    <div class="page__content">
        <main class="page__main">
            <section class="page__section"></section>
            <section class="page__section page__section--color-grey"></section>
            <section class="page__section"></section>
        </main>
        <aside class="page__sidebar sidebar"></aside>
    </div>
    <footer class="page__footer main-footer"></footer>
</body>
</html>
```
В рамках БЭМ-а есть понятие [миксование](https://ru.bem.info/methodology/key-concepts/#%D0%BC%D0%B8%D0%BA%D1%81).
Например `<header class="page__header main-header">` ― `page__header` будет содержать стили, которые размещают хедер в
общем layout-е страницы, а `main-header` будет отвечать за стили внутри самой шапки. Атрибут `class` всегда должен быть
первым, чтобы было удобно искать название классов в разметке.

### Стили
Есть два типа файлов стилей ― глобальные и стили блока. Глобальные файлы стилей лежат в папке `./scss`:
- `style.scss` это основной файл. В него мы импортируем все стили блоков и библиотек
- `_mixins.scss` sass-миксины
- `_typography.scss` адаптация размера шрифта, вертикальный ритм
- `_utils.scss` утилитарные классы, которые мы не можем логически связать с каким-то блоком
- `_variables.scss` глобальные переменные проекта такие как цвета, медиа-запросы

Sass-библиотеки предоставляют следующие глобальные миксины:
- `vr()` миксин для вертикального ритма. `vr(1) = baseFontsize * baseLineHeight` настраивается в `_typography.scss`
- `span()` миксин для расчета ширины колонок ― `width: span(3 of 12);`
- `gutter()` миксин для вставки отступа между колонками с шириной, заданной через `span()` миксин

Стили блока лежат в `./components/block/_block.scss`. Правила оформления файла стилей:
1. В файле только стили для одного блока. Нельзя в файле `_page.scss` стилизовать блок `main-header`.
Используйте миксование в таких случаях
2. Запрещено использовать селекторы с вложенностью больше 2. Так можно `.block__description span {}`, а так нельзя
`.product-list li a span {}`
3. Sass вложенность используем только для модификаторов, псевдо-элементов, псевдо-селекторов и медиа-выражений.
    Так можно:
    ```scss
    .block {
      &:hover {}
      &::before {}
      &--modifier {}
      &--modifier:hover {}
    }
    ```
    Так нельзя:
    ```scss
    .block {
      &__element {}

      &--modifier {
        &:hover {}
      }
    }
    ```
4. Не должно быть ошибок Stylelint'а. Для того, чтобы редактор подсвечивал несоответствие правилам, установите плагин
Stylelint.

### Картинки
Система сборки предоставляет возможность оптимизировать изоброжение, создавать `png` и `svg` спрайты.
При выполнение команды `gulp img:opti` будут созданы оптимизированные копии изображений из директории
`img/src/` (`*.{jpg, png, svg}`) и сложены в директорию `img/dest`.

При выполнении команды `gulp sprite:png` все png-иконки из папки `img/sprite` будут склеены в одну png-картинку,
которая после оптимизации отправляется в `img/dest`. Также, будет создан файл `scss/_sprite-png.scss`.
Его нужно подключить в основной файл стилей `style.scss`. В нем будут стили для всех иконок ― размеры,
`background-position` и `background-image`.

Теперь вы можете использовать спрайт с помощью миксина в `*.scss` файлах
(пример для иконки с названием `icon-search.png`):
  ```scss
  .block {
    &::before {
      @include sprite($icon-search)
    }
  }
  ```
Также, если есть необходимость вставить HTML-элемент с png-иконкой, вы можете использовать блок `icon`:
  ```php
  <?php
  get_component('icon', array(
      'icon' => 'icon-search',
      'is_png' => true,
  ));
  ?>
  ```

При выполнении команды `gulp sprite:svg` все svg-иконки из папки `img/symbols` будут склеены в svg-файл, где каждому
символу будет присвоен `id`, соответствующий названию файла. У иконок с префиксом `icon-` будут удалены атрибуты `fill`.
Если ваша svg-иконка иконка одноцветная, используйте префикс `icon-`.
Если нужна много цветность ― префикс использовать не нужно. Пример использования:

  ```php
  <?php
  get_component('icon', array(
      'icon' => 'icon-search',
      'class' => 'icon--color-red', // красим иконку в нужный цвет
  ));
  ?>
  ```

Для корректной работы внешнего svg-файла, используется JS-библиотека
[svg4everybody](https://github.com/jonathantneal/svg4everybody).


## Работа с блоками
Блок ― логически и функционально независимый компонент страницы. В файловой структуре проекта представлен папкой 
в директории `components/` с названием блока, в которой лежат два файла ― `block.php` и `_block.scss`.
Для удобного создания новых блоков достаточно воспользоваться командой `node createComponent.js your-block-name` или
создать bash-алиас `component your-block-name`. Команда автоматически создаст папку с файлами.

Чтобы подключить стили блока используйте sass-директиву `@import`. Чтобы использовать блок в шаблоне используйте
функцию `get_component` (которая описана в `functions.php`). У неё на вход есть три параметра:
1. `$file {string}` ― имя блока, который вы хотите вызвать
2. `$params {array}` ― массив параметров
3. `$return {boolean}` ― флаг, по-умолчанию равный `false`, для возврата блока, а не вывода его в буффер вывода

```php
<?php
get_component('block-name', array(
    'param1' => 'value1',
    'param2' => 'value2',
    'param3' => 'value3',
));
?>
```
В этой функции есть общие параметры, которые часто используются. Например `class`, `entity_data`, `storage_list`.
Если вам нужны параметры для реализации блока, передайте из в массиве аргументов и объявите внутри файла `block.php`


## Основные команды
```bash
# создаст папку demo-block, _demo-block.scss и demo-block.php 
$ node createComponent.js demo-block

# Запускает сборку проекта ― оптимизирует картинки, собирает спрайты, компилирует и минифицирует стили.
$ gulp build

# Создает локальный дев сервер и запускает watch-ры, которые отслеживают изменения в файлах и автоматически обновляют страницу
$ gulp serve

# Оптимизирует все изображение в папке `./img/src/` и складывает их в `./img/dest`
$ gulp img:opti

# Генерирует png-спрайт на базе иконок, которые лежат в `./img/sprite/`
$ gulp sprite:png

# Генерирует svg-спрайт на базе иконок, которые лежат в `./img/symbols/`
$ gulp sprite:svg

# Собирает все `*.scss` файлы `./components/**/*` и `./scss/` в один `style.css`, минифицирует и создает source maps
$ gulp style:compile
```
